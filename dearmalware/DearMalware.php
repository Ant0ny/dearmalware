<?php

namespace DearMalware;

use DearMalware\DirectoryExplorer;
use DearMalware\FileChecker;

class DearMalware {
    public $post;

    public function __construct() {
        @session_start();
    }

    /**
     * Run application.
     *
     * @return string
     */
    public function run() {

        $output = '';
        $is_found = FALSE;
        $arr = [];

        if ($_POST['action'] == 'get_structure') {
          $explorer = new DirectoryExplorer();
          $output = $explorer->listDirectories();
        }

        if ($_POST['action'] == 'check_viruses') {
          $file_checker = new FileChecker();
          $arr = $file_checker->filesChecking();
          $output = $arr[0];
          $is_found = $arr[1];
        }

        $this->outputJsonResponse($output, $is_found);
    }

    /**
     * Outputs response in Json format.
     *
     * @param mixed $output
     * @param mixed $is_found
     * @return string
     */
    private function outputJsonResponse($output, $is_found) {

        header('Content-type: application/json; charset=utf-8');

        echo json_encode(
            [
                'what_found' => $output,
                'is_found' => $is_found,
            ]
        );

        exit;
    }

}